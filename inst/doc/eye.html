<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Tjebo Heeren" />

<meta name="date" content="2021-09-04" />

<title>eye</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">eye</h1>
<h4 class="author">Tjebo Heeren</h4>
<h4 class="date">2021-09-04</h4>



<div id="see-more-with-eye" class="section level2">
<h2>See more with <em>eye</em></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(eye)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(eyedata)</span></code></pre></div>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p><em>eye</em> is dedicated to facilitate ophthalmic research, providing convenient application programming interfaces (API) for common tasks:</p>
<ul>
<li><a href="#visual-acuity">Handling of visual acuity notations</a></li>
<li><a href="#count-patients-and-eyes">Easy count of patients and eyes</a></li>
<li><a href="#recoding-the-eye-variable">Easy recoding of your eye variable</a></li>
<li>Reshape your eye data - <a href="#myop">long</a> or <a href="#hyperop">wide</a></li>
<li><a href="#blink">Quick summary of your eye data</a></li>
<li><a href="#reveal">Get common summary statistics</a></li>
<li><a href="#getage">Calculate age</a></li>
<li><a href="#clean-na-entries">Clean NA equivalent entries</a></li>
</ul>
<p><em>eye</em> includes a <a href="#va-conversion-chart">visual acuity conversion chart</a>.</p>
</div>
<div id="visual-acuity" class="section level2">
<h2>Visual acuity</h2>
<p>Pesky visual acuity notations are now a matter of the past. Convert between any of Snellen (meter/ feet/ decimal!), logMAR and ETDRS. The notation will be detected automatically and converted to the desired notation. For some more details see <a href="#va-conversion">VA conversion</a>. For entries with mixed notation, use <code>va_mixed</code> instead.</p>
<p>You can also decide to simply “clean” your VA vector with <code>cleanVA(x)</code>. This will remove all entries that are certainly no VA.</p>
<p><code>va()</code> (and of course, its wrappers) cleans and converts visual acuity notations (classes) between Snellen (decimal, meter and feet), ETDRS, and logMAR. Each class can be converted from one to another. <code>va()</code> will detect the class automatically based on specific rules detailed below. Calling va() without specifying the “to” argument will simply clean the visual acuity entries - any notations will be accepted, no plausibility checks yet performed. This is then bascially a wrapper around <code>cleanVA</code>.</p>
<p>It takes an (atomic) vector with visual acuity entries as the only required argument. The user can specify the original VA notation, but va will check that and ignore the argument if implausible.</p>
<div id="conversion-steps" class="section level3">
<h3>Conversion steps</h3>
<p><code>va()</code> basically runs three main steps:</p>
<ol style="list-style-type: decimal">
<li><a href="#cleaning">Entry cleaning</a> with <code>clean_va()</code></li>
<li><a href="#detection">Notation detection</a> with <code>which_va()</code></li>
<li><a href="#plausibility">Plausibility checks</a> with <code>checkVA()</code></li>
<li><a href="#conversion">Conversion</a> with the S3 generic <code>convertVA()</code></li>
</ol>
</div>
<div id="cleaning" class="section level3">
<h3>Cleaning</h3>
<ol style="list-style-type: decimal">
<li><code>NA</code> are assigned to missing entries or strings representing such entries (“.”, &quot;“,”{any number of spaces}“,”N/A“,”NA“,”NULL“,”-&quot;)</li>
<li>Notation for qualitative entries is simplified (NPL becomes NLP, PL becomes LP).</li>
<li>“plus” and “minus” from Snellen entries are converted:
<ul>
<li>if entry -2 to +2 : take same Snellen value</li>
<li>if &lt; -2 : take Snellen value one line below</li>
<li>if &gt;+2 : Snellen value one line above</li>
</ul></li>
</ol>
<p>Snellen are unfortunately often entered with “+/-”, which is a violation of psychophysical methods designed to assign one (!) unambiguous value to visual acuity, with non-arbitrary thresholds based on psychometric functions. Therefore, transforming “+/-” notation to actual results is in itself problematic and the below suggestion to convert it will remain an approximation to the most likely “true” result. Even more so, as the given conditions should work for charts with 4 or 5 optotypes in a line, and visual acuity is not always tested on such charts. Yet, I believe that the approach is still better than just omitting the letters or (worse) assigning a missing value to those entries.</p>
<p>If the argument <code>smallstep = TRUE</code>, the entries will be converted to logmar values (0.02 logmar for each optotype). This is based on the assumption of 5 optotypes in a row. This argument can be overriden with <code>noplus = TRUE</code>, ignoring the plus minus entries entirely and simply returning the nearest Snellen values.</p>
</div>
<div id="detection" class="section level3">
<h3>Detection</h3>
<ul>
<li>Internally done with <code>which_va()</code> based on the following rules</li>
<li>if x integer and 3 &lt; x &lt;= 100: <code>etdrs</code></li>
<li>if x integer and 0 &lt;= x &lt;= 3: <code>logmar</code>, <code>snellendec</code> or <code>etdrs</code></li>
<li>if x numeric and -0.3 &lt;= x &lt;= 3: <code>logmar</code> or <code>snellendec</code></li>
<li>if character and format x/y: <code>snellen</code> (fraction)</li>
<li>if one of “CF”, “HM”, “LP”, “PL”, “NLP”, or “NPL”: <code>quali</code></li>
</ul>
<div id="accepted-va-formats-plausibility-checks-plausibility" class="section level4">
<h4>Accepted VA formats / Plausibility checks [#plausibility]</h4>
<ul>
<li>Snellen fractions (meter/ feet) need to be entered as fraction with “/”. <strong>any fraction is allowed</strong> e.g. 3/60 and 2/200 will also be recognized.</li>
<li>ETDRS must be integer-equivalent between 0 and 100 (integer equivalent means, it can also be a character vector)</li>
<li>logMAR must be between -0.3 and 3.0</li>
<li>snellendec must be greater than 0 and smaller or equal to 2</li>
<li>Qualitative must be either of PL, LP, NLP, NPL, HM, CF (any case allowed)</li>
<li>Any element which is implausible / not recognized will be converted to NA</li>
</ul>
</div>
</div>
<div id="conversion" class="section level3">
<h3>Conversion</h3>
<ul>
<li><strong>logMAR to ETDRS</strong>: logMAR rounded to the first digit and converted with the chart.</li>
<li><strong>Snellen to logMAR</strong>: logMAR = -1 * log10(snellen_frac)</li>
<li><strong>Snellen to ETDRS</strong>: ETDRS = 85 + 50 * log10(snellen_frac) <a href="https://doi.org/10.1097/iae.0b013e3181d87e04">Gregori et al.</a>.</li>
<li><strong>ETDRS to logMAR</strong>: logMAR = -0.02 * etdrs + 1.7 <a href="https://doi.org/10.1016/s0002-9394(02)01825-1">Beck et al.</a></li>
<li><strong>Hand movements and counting fingers</strong> are converted following Schulze-Bonsel et al. (<a href="https://doi.org/10.1167/iovs.05-0981" class="uri">https://doi.org/10.1167/iovs.05-0981</a>)</li>
<li><strong>(No) light perception</strong> are converted following the suggestions by <a href="https://michaelbach.de/sci/acuity.html">Michael Bach</a></li>
<li><strong>To Snellen</strong>: Although there seems to be no good statistical reason to convert back to Snellen, it is a very natural thing to eye specialists to think in Snellen. A conversion to snellen gives a good gauge of how the visual acuity for the patients are. However, back-conversion should not be considered an exact science and any attempt to use formulas will result in very weird Snellen values that have no correspondence to common charts. Therefore, Snellen matching the nearest ETDRS and logMAR value in <a href="#va-conversion-chart">the VA conversion chart</a> are used.</li>
</ul>
</div>
<div id="examples" class="section level3">
<h3>Examples</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## automatic detection of VA notation and converting to logMAR by default</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">23</span>, <span class="dv">56</span>, <span class="dv">74</span>, <span class="dv">58</span>) <span class="do">## ETDRS letters</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">to_logmar</span>(x) <span class="co"># wrapper of va(x, to = &quot;logmar&quot;)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; From etdrs</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.24 0.58 0.22 0.54</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ... or convert to snellen</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">to_snellen</span>(x) <span class="co"># wrapper of va(x, to = &quot;snellen&quot;) </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; From etdrs</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;20/320&quot; &quot;20/80&quot;  &quot;20/32&quot;  &quot;20/70&quot;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="do">## eye knows metric as well </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">to_snellen</span>(x, <span class="at">type =</span> <span class="st">&quot;m&quot;</span>) </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; From etdrs</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;6/96&quot;  &quot;6/24&quot;  &quot;6/9.6&quot; &quot;6/21&quot;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="do">## And the decimal snellen notation, so much loved in Germany</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">to_snellen</span>(x, <span class="at">type =</span> <span class="st">&quot;dec&quot;</span>) </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; From etdrs</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;0.062&quot; &quot;0.25&quot;  &quot;0.625&quot; &quot;0.3&quot;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Remove weird entries and implausible entries depending on the VA choice</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;NLP&quot;</span>, <span class="st">&quot;0.8&quot;</span>, <span class="st">&quot;34&quot;</span>, <span class="st">&quot;3/60&quot;</span>, <span class="st">&quot;2/200&quot;</span>, <span class="st">&quot;20/50&quot;</span>, <span class="st">&quot;  &quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;-&quot;</span>, <span class="st">&quot;NULL&quot;</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">to_snellen</span>(x)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; From snellen. Could be snellen, logmar, snellendec, etdrs</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6x NA introduced for: 0.8, 34,   , ., -, NULL</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;20/20000&quot; NA         NA         &quot;20/400&quot;   &quot;20/2000&quot;  &quot;20/50&quot;   </span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] NA         NA         NA         NA</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="fu">to_snellen</span>(x, <span class="at">from =</span> <span class="st">&quot;snellendec&quot;</span>)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8x NA introduced for: 34, 3/60, 2/200, 20/50,   , ., -, NULL</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;20/20000&quot; &quot;20/25&quot;    NA         NA         NA         NA        </span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] NA         NA         NA         NA</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="fu">to_snellen</span>(x, <span class="at">from =</span> <span class="st">&quot;etdrs&quot;</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8x NA introduced for: 0.8, 3/60, 2/200, 20/50,   , ., -, NULL</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;20/20000&quot; NA         &quot;20/200&quot;   NA         NA         NA        </span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] NA         NA         NA         NA</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="fu">to_snellen</span>(x, <span class="at">from =</span> <span class="st">&quot;logmar&quot;</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8x NA introduced for: 34, 3/60, 2/200, 20/50,   , ., -, NULL</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;20/20000&quot; &quot;20/125&quot;   NA         NA         NA         NA        </span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] NA         NA         NA         NA</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="do">## &quot;plus/minus&quot; entries are converted to the most probable threshold (any spaces allowed) </span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;20/200 - 1&quot;</span>, <span class="st">&quot;6/6-2&quot;</span>, <span class="st">&quot;20/50 + 3&quot;</span>, <span class="st">&quot;6/6-4&quot;</span>, <span class="st">&quot;20/33 + 4&quot;</span>)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="fu">to_logmar</span>(x)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; From snellen</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.0 0.0 0.3 0.1 0.1</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="do">## or evaluating them as logmar values (each optotype equals 0.02 logmar)</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="fu">to_logmar</span>(x, <span class="at">smallstep =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; From snellen</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.02 0.04 0.34 0.08 0.14</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="do">## or you can also decide to completely ignore them (converting them to the nearest snellen value in the VA chart)</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="fu">to_snellen</span>(x, <span class="at">noplus =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; From snellen</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;20/200&quot; &quot;20/20&quot;  &quot;20/50&quot;  &quot;20/20&quot;  &quot;20/32&quot;</span></span></code></pre></div>
</div>
</div>
<div id="recode" class="section level2">
<h2>recodeye</h2>
<p>Makes recoding eye variables very easy.</p>
<p>The following codes are recognized:</p>
<ul>
<li>integer coding 0:1 and 1:2, right eye being the lower number.</li>
<li>right eyes: c(“r”, “re”, “od”, “right”) and</li>
<li>left eyes: c(“l”, “le”, “os”, “left”) and</li>
<li>both eyes: c(“b”, “both”, “ou”)</li>
</ul>
<p>If you have different codes, you can change the recognized strings with the <code>eyestrings</code> argument, which needs to be a list. But remember to put the strings for right eyes first, or pass a <em>named list</em>.</p>
<p>You can also more globally change recognized codes with <code>set_eye_strings()</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;re&quot;</span>, <span class="st">&quot;od&quot;</span>, <span class="st">&quot;right&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;le&quot;</span>, <span class="st">&quot;os&quot;</span>, <span class="st">&quot;left&quot;</span>, <span class="st">&quot;both&quot;</span>, <span class="st">&quot;ou&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">recodeye</span>(x)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;r&quot; &quot;r&quot; &quot;r&quot; &quot;r&quot; &quot;l&quot; &quot;l&quot; &quot;l&quot; &quot;l&quot; &quot;b&quot; &quot;b&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="do">## chose the resulting codes</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">recodeye</span>(x, <span class="at">to =</span> <span class="fu">c</span>(<span class="st">&quot;od&quot;</span>, <span class="st">&quot;os&quot;</span>, <span class="st">&quot;ou&quot;</span>))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;od&quot; &quot;od&quot; &quot;od&quot; &quot;od&quot; &quot;os&quot; &quot;os&quot; &quot;os&quot; &quot;os&quot; &quot;ou&quot; &quot;ou&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Numeric codes 0:1/ 1:2 are recognized </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">recodeye</span>(x)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Eyes coded 1:2. Interpreting r = 1</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;r&quot; &quot;l&quot;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="do">## with weird missing values</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;.&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;    &quot;</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">recodeye</span>(x)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Missing values and/or meaningless strings contained</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Eyes coded 1:2. Interpreting r = 1</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;r&quot; &quot;l&quot; NA  NA  NA  NA</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="do">## If you are using different strings to code for eyes, e.g., you are using a different language, you can change this either with the &quot;eyestrings&quot; argument</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>french <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;OD&quot;</span>, <span class="st">&quot;droit&quot;</span>, <span class="st">&quot;gauche&quot;</span>, <span class="st">&quot;OG&quot;</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="fu">recodeye</span>(french, <span class="at">eyestrings =</span> <span class="fu">list</span>(<span class="at">r =</span> <span class="fu">c</span>(<span class="st">&quot;droit&quot;</span>, <span class="st">&quot;od&quot;</span>), <span class="at">l =</span> <span class="fu">c</span>(<span class="st">&quot;gauche&quot;</span>, <span class="st">&quot;og&quot;</span>)))</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;r&quot; &quot;r&quot; &quot;l&quot; &quot;l&quot;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="do">## or change it more globally with `set_eye_strings`</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="fu">set_eye_strings</span>(<span class="at">right =</span> <span class="fu">c</span>(<span class="st">&quot;droit&quot;</span>, <span class="st">&quot;od&quot;</span>), <span class="at">left =</span> <span class="fu">c</span>(<span class="st">&quot;gauche&quot;</span>, <span class="st">&quot;og&quot;</span>))</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="fu">recodeye</span>(french)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;r&quot; &quot;r&quot; &quot;l&quot; &quot;l&quot;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"># to restore the default, call set_eye_strings empty</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="fu">set_eye_strings</span>()</span></code></pre></div>
</div>
<div id="eyes" class="section level2">
<h2>Counting patients and eyes</h2>
<p><code>eyes</code> offers a very simple tool for counting patients and eyes. It will return a list object which gives you easy access to the data.</p>
<p>An important step in <code>eyes</code> is the guessing of the columns that identify patients and eyes. As for <code>myop</code> and of course <code>blink</code>, a specific column naming is required for a reliable automatic detection of patient and eye column(s) ( <a href="#names-and-codes">see Names and codes</a>)</p>
<p>The arguments <strong>id</strong> and <strong>eye</strong> arguments overrule the name guessing for the respective columns.</p>
<div id="guessing" class="section level3">
<h3>Guessing</h3>
<div id="patient-id-columns" class="section level4">
<h4>patient ID columns:</h4>
<ul>
<li>names can be in any case.</li>
<li>First, <code>eyes</code> is looking for names that contain both strings “pat” and “id” (the order doesn’t matter) you can change those codes with <code>set_eye_strings()</code></li>
<li>Next, it will look for columns that are plainly called “ID”</li>
<li>Last, it will search for all names that contain either “pat” or “id”</li>
</ul>
</div>
<div id="eye-variable-column" class="section level4">
<h4>eye variable column:</h4>
<ul>
<li>names can be in any case.</li>
<li><code>eyes</code> looks for columns that contain the string either “eye” or “eyes” - you can change those codes with <code>set_eye_strings()</code></li>
<li>columns will full string “eye” or “eyes” will be given precedence</li>
</ul>
</div>
</div>
<div id="counting" class="section level3">
<h3>Counting</h3>
<p>For counting eyes, eyes need to be coded in commonly used ways. You can use <a href="#recode">recodeye</a> for very convenient recoding.</p>
<ul>
<li><p><code>eyes</code> recognizes integer coding 0:1 and 1:2, with right being the lower number.</p></li>
<li><p>Or, arguably more appropriate in R, character coding for a categorical variable:</p>
<ul>
<li>right eyes: c(“r”, “re”, “od”, “right”)</li>
<li>left eyes: c(“l”, “le”, “os”, “left”)</li>
<li>both eyes: c(“b”, “both”, “ou”)</li>
</ul></li>
<li><p>you can change those codes with <code>set_eye_strings()</code></p></li>
</ul>
</div>
<div id="report" class="section level3">
<h3>Report:</h3>
<p><code>eyes</code> also include a convenience function to turn the count into a text. This is intended for integration into rmarkdown reports, or for easy copy / pasting. <code>eyes_to_string()</code> parses the output of <code>eyes</code> into text under the hood. Arguments to <code>eyes_to_string</code> are passed via <strong>…</strong>:</p>
<ul>
<li><strong>english</strong> Which numbers to be written in plain english: choose “small” for numbers till 12, “all” (all numbers), or “none” (or any other string!) for none</li>
<li><strong>caps</strong> First number will have capital letter</li>
</ul>
<p><strong>eyestr</strong> will create a string which you can paste into a report. The name was chosen because it’s a contraction of “eyes” and “strings” and it’s a tiny bit easier to type than “eyetxt”.</p>
<div id="use-in-rmarkdown" class="section level4">
<h4>Use in rmarkdown</h4>
<p><code>eyestr</code> was designed with the use in rmarkdown in mind, most explicitly for the use inline. You can change the way numbers are converted to english with the <code>english</code> argument. By default, numbers smaller than or equal to 12 will be real English, all other numbers will be … numbers. You can capitalise the first number with the <code>caps</code> argument.</p>
<p>We analyzed <code>`r eyestr(amd2)`</code> gives: We analyzed 3357 eyes of 3357 patients We analyzed <code>`r eyestr(head(amd2, 100))`</code>gives: We analyzed eleven eyes of eleven patients We analyzed <code>`r eyestr(amd2, english = &quot;all&quot;)`</code> gives: We analyzed three thousand three hundred and fifty-seven eyes of three thousand three hundred and fifty-seven patients <code>`r eyestr(head(amd2, 100), caps = TRUE)`</code> were analyzed gives: Eleven eyes of eleven patients were analyzed We analyzed <code>`r eyestr(head(amd2, 100), english = &quot;none&quot;)`</code> gives: We analyzed 11 eyes of 11 patients</p>
</div>
</div>
</div>
<div id="reshape-eye-data" class="section level2">
<h2>Reshape eye data</h2>
<p>Out of convenience, data is often entered in a “wide” format: In eye research, there will be often two columns for the same variable, one column for each eye.</p>
<p>This may be a necessary data formal for specific questions.</p>
<p>However, “eye” is also variable (a dimension of your observation), and it can also be stored in a separate column. Indeed, in my experience R often needs eyes to be in a single column, with each other variable having their own dedicated column.</p>
<div id="myop" class="section level3">
<h3>myop</h3>
<p>Reshaping many such columns can be a daunting task, and <code>myop()</code> makes this easier. It will remove duplicate rows, and pivot the eye variable to one column and generate a single column for each variable, thus shaping the data for specific types of analysis. For example, eight columns that store data of four variables for right and left eyes will be pivoted to 5 columns (one eye column and four further variable columns)). See also <strong>Examples</strong>.</p>
<p>As with <code>eyes()</code>, <code>myop()</code> requires a specific data format. <a href="#names-and-codes">See names and codes</a> If there is already a column called “eye” or “eyes”, myop will not make any changes - because the data is then already assumed to be in long format.</p>
<p>If there still are variables spread over two columns for right and left eyes, then this is an example of messy data. A solution would be to remove or simply rename the “eye” column and then let myop do the work. However, you need to be very careful in those cases if resulting data frame is plausible.</p>
<p><a href="https://tidyr.tidyverse.org/articles/tidy-data.html">Learn about tidy data.</a></p>
<div id="make-myop-work" class="section level4">
<h4>Make myop work</h4>
<p>myop will work reliably if you adhere to the following:</p>
<ol style="list-style-type: decimal">
<li>Common codes for eyes:
<ul>
<li>Right eyes: <em>“r”, “re”, “od”, “right”</em></li>
<li>Left eyes: <em>“l”, “le”, “os”, “left”</em></li>
</ul></li>
<li>strings for eyes need to be <strong>separated by period or underscores</strong>. (Periods will be replaced by underscores).</li>
<li>Any order of substrings is allowed:
<ul>
<li><strong>Will work</strong>: “va_r”, “right_morningpressure”, “night_iop.le”, “gat_os_postop”</li>
<li><strong>Will fail</strong>: “VAr”, “rightmorningPressure”, “night_IOPle”, “gatOSpostop”</li>
</ul></li>
</ol>
<p>An exception is when there is only one column for each eye. Then the column names can consist of “eye strings” only. In this case, the argument <em>var</em> will be used to name the resulting variable.</p>
<p>If there are only eye columns in your data (should actually not happen), myop will create identifiers by row position.</p>
<p><strong>Please always check the result for plausibility.</strong> Depending a lot on how the data was entered, the results could become quite surprising. There is basically a nearly infinite amount of possible combinations of how to enter data, and it is likely that myop will not be able to deal with all of them.</p>
</div>
<div id="myop-under-the-hood" class="section level4">
<h4>myop under the hood</h4>
<p><code>myop()</code> basically runs three main steps:</p>
<ol style="list-style-type: decimal">
<li>Removing duplicates</li>
<li>Rename data names with <code>myop_rename()</code> and <code>sort_substr()</code>:
<ul>
<li>Replacing “.” by &quot;_&quot;</li>
<li>Re-arranging and recoding substrings in a way that strings for eyes always appear at first position. They will be recoded to “r” and “l”</li>
</ul></li>
<li>Myopization: The actual work is done with <code>myopizer()</code> and <code>myop_pivot()</code> and itself consists of three steps.
<ul>
<li>All columns with an eye string at first position will be selected pivoted to two long colums (<code>key</code> and <code>value</code>) using <code>tidyr::pivot_longer</code>.</li>
<li>The <code>key</code> column will be split by position into an eye column and a <code>variable</code> column.</li>
<li>The <code>variable</code> and <code>value</code> columns will be pivoted wide again with <code>tidyr::pivot_wider</code>.</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>wide1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],  <span class="at">r =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">13</span> , <span class="at">l =</span> <span class="dv">14</span><span class="sc">:</span><span class="dv">16</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>iop_wide <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">iop_r =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>, <span class="at">iop_l =</span> <span class="dv">14</span><span class="sc">:</span><span class="dv">16</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Mildly messy data frame with several variables spread over two columns:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>wide_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">surgery_right =</span> <span class="fu">c</span>(<span class="st">&quot;TE&quot;</span>, <span class="st">&quot;TE&quot;</span>, <span class="st">&quot;SLT&quot;</span>, <span class="st">&quot;SLT&quot;</span>),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">surgery_left =</span> <span class="fu">c</span>(<span class="st">&quot;TE&quot;</span>, <span class="st">&quot;TE&quot;</span>, <span class="st">&quot;TE&quot;</span>, <span class="st">&quot;SLT&quot;</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iop_r_preop =</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">24</span>, <span class="at">iop_r_postop =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">14</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iop_l_preop =</span> <span class="dv">31</span><span class="sc">:</span><span class="dv">34</span>, <span class="at">iop_l_postop =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">14</span>, </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">va_r_preop =</span> <span class="dv">41</span><span class="sc">:</span><span class="dv">44</span>, <span class="at">va_r_postop =</span> <span class="dv">45</span><span class="sc">:</span><span class="dv">48</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">va_l_preop =</span> <span class="dv">41</span><span class="sc">:</span><span class="dv">44</span>, <span class="at">va_l_postop =</span> <span class="dv">45</span><span class="sc">:</span><span class="dv">48</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## the variable has not been exactly named, (but it is probably IOP data), </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="do">## you can specify the dimension with the var argument</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">myop</span>(wide1, <span class="at">var =</span> <span class="st">&quot;iop&quot;</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id    eye   iop  </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 a     right 11   </span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 a     left  14   </span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 b     right 12   </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 b     left  15   </span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 c     right 13   </span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 c     left  16</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="do">## If the dimension is already part of the column names, this is not necessary. </span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="fu">myop</span>(iop_wide)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id    eye   iop  </span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 a     right 11   </span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 a     left  14   </span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 b     right 12   </span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 b     left  15   </span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 c     right 13   </span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 c     left  16</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="do">## myop deals with this in a breeze:</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="fu">myop</span>(wide_df)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 8 × 7</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id    eye   surgery iop_preop iop_postop va_preop va_postop</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;    </span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 a     right TE      21        11         41       45       </span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 a     left  TE      31        11         41       45       </span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 b     right TE      22        12         42       46       </span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 b     left  TE      32        12         42       46       </span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 c     right SLT     23        13         43       47       </span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 c     left  TE      33        13         43       47       </span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 d     right SLT     24        14         44       48       </span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8 d     left  SLT     34        14         44       48</span></span></code></pre></div>
</div>
</div>
<div id="hyperop" class="section level3">
<h3>hyperop</h3>
<p>Basically the opposite of <code>myop()</code> - a slightly intelligent wrapper around <code>tidyr::pivot_longer()</code> and <code>tidyr::pivot_wider()</code>. Will find the eye column, unify the codes for the eyes (all to “r” and “l”) and pivot the columns wide, that have been specified in “cols”. <strong>Again, good names and tidy data always help!</strong></p>
<p>The cols argument takes a tidyselection. <a href="https://tidyselect.r-lib.org/reference/language.html">Read about tidyselection</a></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>myop_df <span class="ot">&lt;-</span> <span class="fu">myop</span>(wide_df)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hyperop</span>(myop_df, <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">&quot;va|iop&quot;</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 10</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id    surgery r_iop_preop r_iop_postop r_va_preop r_va_postop l_iop_preop</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;      </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 a     TE      21          11           41         45          31         </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 b     TE      22          12           42         46          32         </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 c     SLT     23          13           43         47          &lt;NA&gt;       </span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 c     TE      &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;        33         </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 d     SLT     24          14           44         48          34         </span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 3 more variables: l_iop_postop &lt;chr&gt;, l_va_preop &lt;chr&gt;,</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   l_va_postop &lt;chr&gt;</span></span></code></pre></div>
</div>
</div>
<div id="blink" class="section level2">
<h2>blink</h2>
<p>Although kind of nice, blink is more a nerdy extra and is not likely to be used much. Therefore I decided to stop the work on it. It will be left in the package as such.</p>
<p><strong>See your data in a blink of an eye</strong></p>
<p><code>blink()</code> is more than just a wrapper around <code>myop()</code>, <code>eyes()</code>, <code>va()</code> and <code>reveal()</code>. It will look for VA and for IOP columns and provide the summary stats for the entire cohort and for right and left eyes for each VA and IOP variable.</p>
<p><strong>This, again, requires a certain format of names and codes</strong> - <a href="#names-and-codes">See Names and Codes</a></p>
<div id="work-under-the-hood" class="section level3">
<h3>Work under the hood</h3>
<ol style="list-style-type: decimal">
<li>Removing duplicates</li>
<li>Identification of the index of the VA and IOP columns</li>
<li>Remove certain columns from analysis:
<ul>
<li>Logical columns</li>
<li>Character columns if they are not coding for Snellen fractions or “qualitative visual acuity”</li>
<li>Those with unique values in the range of the vector defined by the argument “fct_level”. Those are removed because they are likely categorical codes. If you have columns with VA or IOP that contain only 0 and 1 for example (which is unlikely, but not impossible), you can just set <code>fct_level = &quot;x&quot;</code> or any other arbitrary value.</li>
</ul></li>
<li>Rename data names with <code>myop_rename()</code> and <code>sort_substr()</code></li>
<li>Getting the new names based on the indices of the columns</li>
<li>Creating a vector of “expected new names” for the summary after myopization</li>
<li>Myopizing if possible</li>
<li>Converting VA vectors to logMAR</li>
<li>Applying <code>reveal()</code> to all VA and IOP columns.</li>
</ol>
<p>As you can imagine, a lot of those steps rely hugely on reasonable naming of your columns and this is what makes this function unfortunately a bit fragile. However, if you adhere to the naming conventions, blink (and myop) will do a great job for you.</p>
<p>If you are not happy with the automatic column selection, you can manually select the VA and IOP columns with the arguments <code>va_cols</code> or <code>iop_cols</code>. Both accept <a href="https://tidyselect.r-lib.org/reference/language.html">tidyselection</a>. I personally find <code>starts_with</code>, <code>ends_with</code>, <code>contains()</code> or the more general <code>matches()</code> very useful.</p>
</div>
<div id="examples-1" class="section level3">
<h3>Examples</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">blink</span>(wide_df)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The lifecycle of blink() has expired. It will no longer be</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   maintained, but will be kept in the package.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; From etdrs</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; From etdrs</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── blink ───────────────────────────────────────────────────────────────────────</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ══ Data ════════════════════════════════</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 8 × 7</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id    eye   surgery iop_preop iop_postop va_preop va_postop</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;      &lt;logmar&gt; &lt;logmar&gt; </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 a     right TE      21        11         0.88     0.80     </span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 a     left  TE      31        11         0.88     0.80     </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 b     right TE      22        12         0.86     0.78     </span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 b     left  TE      32        12         0.86     0.78     </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 c     right SLT     23        13         0.84     0.76     </span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 c     left  TE      33        13         0.84     0.76     </span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 d     right SLT     24        14         0.82     0.74     </span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8 d     left  SLT     34        14         0.82     0.74     </span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ══ Count of patient and eyes ═══════════</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ══ Counts ═══════════════</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id  eyes right  left </span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     4     8     4     4 </span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ══ Visual acuity ═══════════════════════</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── $VA_total (all eyes)</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         var mean sd n min max</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  va_preop  0.8  0 8 0.8 0.9</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 va_postop  0.8  0 8 0.7 0.8</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── $VA_eyes (right and left eyes)</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     eye       var mean sd n min max</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  left  va_preop  0.8  0 4 0.8 0.9</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  left va_postop  0.8  0 4 0.7 0.8</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 right  va_preop  0.8  0 4 0.8 0.9</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 right va_postop  0.8  0 4 0.7 0.8</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ══ Intraocular pressure ════════════════</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── $IOP_total (all eyes)</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          var mean  sd n min max</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  iop_preop 27.5 5.5 8  21  34</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 iop_postop 12.5 1.2 8  11  14</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── $IOP_eyes (right and left eyes)</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     eye        var mean  sd n min max</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  left  iop_preop 32.5 1.3 4  31  34</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  left iop_postop 12.5 1.3 4  11  14</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 right  iop_preop 22.5 1.3 4  21  24</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 right iop_postop 12.5 1.3 4  11  14</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="fu">blink</span>(amd)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The lifecycle of blink() has expired. It will no longer be</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   maintained, but will be kept in the package.</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Data seems already myopic - no changes made. ?myop for help</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; From etdrs. Could be etdrs, logmar, snellendec</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Unclear which is the eye column. Counting id only.</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Specify eye column with &quot;eye_col&quot; argument</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── blink ───────────────────────────────────────────────────────────────────────</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ══ Data ════════════════════════════════</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 118,255 × 11</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    patid sex   age   avdays_induc ethnicity loaded  time injgiven va       regimen</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt; &lt;chr&gt;     &lt;lgl&gt;  &lt;int&gt; &lt;lgl&gt;    &lt;logmar&gt; &lt;chr&gt;  </span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 id_1  m     60-69           28 se_asian  TRUE       0 TRUE     0.30     ranibi…</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 id_1  m     60-69           28 se_asian  TRUE      28 TRUE     0.30     ranibi…</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 id_1  m     60-69           28 se_asian  TRUE      56 TRUE     0.30     ranibi…</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 id_1  m     60-69           28 se_asian  TRUE      91 TRUE     0.40     ranibi…</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 id_1  m     60-69           28 se_asian  TRUE     131 TRUE     0.46     ranibi…</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 id_1  m     60-69           28 se_asian  TRUE     173 TRUE     0.40     ranibi…</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 id_1  m     60-69           28 se_asian  TRUE     236 TRUE     0.50     ranibi…</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 id_1  m     60-69           28 se_asian  TRUE     278 TRUE     0.50     ranibi…</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 id_1  m     60-69           28 se_asian  TRUE     411 TRUE     0.60     ranibi…</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 id_1  m     60-69           28 se_asian  TRUE     453 TRUE     0.54     ranibi…</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 118,245 more rows, and 1 more variable: pre2013 &lt;lgl&gt;</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ══ Count of patient and eyes ═══════════</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ══ Counts ═══════════════</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id </span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7802 </span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ══ Visual acuity ═══════════════════════</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── $VA_total (all eyes)</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   var mean  sd      n  min max</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  va  0.5 0.4 116530 -0.3 2.3</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── $VA_eyes (right and left eyes)</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ══ Intraocular pressure ════════════════</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── $IOP_total (all eyes)</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── $IOP_eyes (right and left eyes)</span></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
</div>
</div>
<div id="names-and-codes" class="section level2">
<h2>Names and codes</h2>
<p><strong>eye works smoother with tidy data, and with good names</strong> (any package does, really!)</p>
<div id="tidy-data" class="section level3">
<h3>Tidy data</h3>
<p>The basic principle of tidy data is: one column for each dimension and one row for each observation.</p>
<p><a href="https://tidyr.tidyverse.org/articles/tidy-data.html">Learn more about tidy data.</a></p>
<p>This chapter explains how you can improve names and codes so that <code>eye</code> will work like a charm.</p>
</div>
<div id="how-do-i-rename-columns-in-r" class="section level3">
<h3>How do I rename columns in R?</h3>
<p>When I started with R, I found it challenging to rename columns and I found the following methods very helpful:</p>
<p>I’ve got a data frame with unfortunate names:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>name_mess <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="st">&quot;a&quot;</span>, <span class="at">oculus =</span> <span class="st">&quot;r&quot;</span>, <span class="at">eyepressure =</span> <span class="dv">14</span>, <span class="at">vision =</span> <span class="fl">0.2</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(name_mess)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;name&quot;        &quot;oculus&quot;      &quot;eyepressure&quot; &quot;vision&quot;</span></span></code></pre></div>
<p>I can rename all names easily:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(name_mess) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;patID&quot;</span>, <span class="st">&quot;eye&quot;</span>, <span class="st">&quot;IOP&quot;</span>, <span class="st">&quot;VA&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(name_mess)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;patID&quot; &quot;eye&quot;   &quot;IOP&quot;   &quot;VA&quot;</span></span></code></pre></div>
<p>To rename only specific columns, even if you are not sure about their exact position:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## if you only want to rename one or a few columns: </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(name_mess)[<span class="fu">names</span>(name_mess) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;vision&quot;</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;patID&quot;</span>, <span class="st">&quot;VA&quot;</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(name_mess)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;patID&quot;       &quot;oculus&quot;      &quot;eyepressure&quot; &quot;VA&quot;</span></span></code></pre></div>
<p>For even more methods, I found those two threads on Stackoverflow very helpful:</p>
<ul>
<li><a href="https://stackoverflow.com/q/7531868/7941188">Rename single column</a></li>
<li><a href="https://stackoverflow.com/q/20987295/7941188">Rename columns with named vector</a></li>
</ul>
</div>
<div id="tips-and-rules-for-naming" class="section level3">
<h3>Tips and rules for naming:</h3>
<ol style="list-style-type: decimal">
<li>Don’t be too creative with your names!</li>
<li>Use common coding:
<ul>
<li><strong>eyes</strong>: “r”, “re”, “od”, “right” - or numeric coding r:l = 0:1 or 1:2</li>
<li><strong>Visual acuity</strong>: “VA”, “BCVA”, “Acuity”</li>
<li><strong>Intraocular pressure</strong>: “IOP”, “GAT”, “NCT”, “pressure”</li>
<li><strong>Patient identifier</strong>: “pat”, “patient”, “ID” (ideally both: “patientID” or “patID”)</li>
</ul></li>
<li>Column names:
<ul>
<li>No spaces!</li>
<li>Do not use numeric coding for eyes in column names</li>
<li>Separate eye and VA and IOP codes with underscores (“bcva_l_preop”, “VA_r”, “left_va”, “IOP_re”)</li>
<li>Keep names short</li>
<li>Don’t use underscores when you don’t need to: Consider each section divided by an underscore as a relevant characteristic of your variable. E.g., “preop” instead of “pre_op”, or simply “VA” instead of “VA_ETDRS_Letters”</li>
</ul></li>
</ol>
</div>
<div id="name-examples" class="section level3">
<h3>Name examples</h3>
<p>Good names (<code>eye</code> will work nicely)</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## right and left eyes have common codes</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">## information on the tested dimension is included (&quot;iop&quot;)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="do">## VA and eye strings are separated by underscores</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="do">## No unnecessary underscores.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(wide_df)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;id&quot;            &quot;surgery_right&quot; &quot;surgery_left&quot;  &quot;iop_r_preop&quot;  </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;iop_r_postop&quot;  &quot;iop_l_preop&quot;   &quot;iop_l_postop&quot;  &quot;va_r_preop&quot;   </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;va_r_postop&quot;   &quot;va_l_preop&quot;    &quot;va_l_postop&quot;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(iop_wide) </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;id&quot;    &quot;iop_r&quot; &quot;iop_l&quot;</span></span></code></pre></div>
<p>OK names (<code>eye</code> will work)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Id and Eye are common names, there are no spaces</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="do">## VA is separated from the rest with an underscore</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="do">## BUT: </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="do">## The names are quite long </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="do">## There is an unnecessary underscore (etdrs are always letters). Better just &quot;VA&quot;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;Id&quot;</span>, <span class="st">&quot;Eye&quot;</span>, <span class="st">&quot;FollowupDays&quot;</span>, <span class="st">&quot;BaselineAge&quot;</span>, <span class="st">&quot;Gender&quot;</span>, <span class="st">&quot;VA_ETDRS_Letters&quot;</span>, </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;InjectionNumber&quot;</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Id&quot;               &quot;Eye&quot;              &quot;FollowupDays&quot;     &quot;BaselineAge&quot;     </span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] &quot;Gender&quot;           &quot;VA_ETDRS_Letters&quot; &quot;InjectionNumber&quot;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="do">## All names are commonly used (good!)</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="do">## But which dimension of &quot;r&quot;/&quot;l&quot; are we exactly looking at? </span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;r&quot;</span>,  <span class="st">&quot;l&quot;</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;id&quot; &quot;r&quot;  &quot;l&quot;</span></span></code></pre></div>
<p>Bad names (<code>eye</code> will fail)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## VA/IOP not separated with underscore</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="do">## `eye` won&#39;t be able to recognize IOP and VA columns</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;iopr&quot;</span>, <span class="st">&quot;iopl&quot;</span>, <span class="st">&quot;VAr&quot;</span>, <span class="st">&quot;VAl&quot;</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;id&quot;   &quot;iopr&quot; &quot;iopl&quot; &quot;VAr&quot;  &quot;VAl&quot;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="do">## A human may think this is clear</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="do">## But `eye` will fail to understand those variable names</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;person&quot;</span>, <span class="st">&quot;goldmann&quot;</span>, <span class="st">&quot;vision&quot;</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;person&quot;   &quot;goldmann&quot; &quot;vision&quot;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Not even clear to humans</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;var1&quot;</span>, <span class="st">&quot;var2&quot;</span>, <span class="st">&quot;var3&quot;</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;var1&quot; &quot;var2&quot; &quot;var3&quot;</span></span></code></pre></div>
</div>
</div>
<div id="reveal" class="section level2">
<h2>Reveal common statistics</h2>
<p><code>reveal()</code> offers a simple API to show common summary statistics for all numeric columns of your data frame. <code>reveal()</code> is basically a slightly complicated wrapper around <code>mean()</code>, <code>sd()</code>, <code>length()</code>, <code>min()</code> and <code>max()</code> (with na.rm = TRUE and <code>length()</code> counting only non-NA values).</p>
<p>It is not really intended to replace other awesome data exploration packages / functions such as <code>skimr::skim</code>, and it will likely remain focussed on summarizing numerical data only.</p>
<p>It uses an S3 generic under the hood with methods for atomic vectors, data frames, and lists of either atomic vectors or data frames. Character vectors will be omitted (and it should give a warning that it has done so).</p>
<p><code>reveal()</code> takes the grouping argument <code>by</code> and it returns vector for atomic vectors or a data frame for lists.</p>
<div id="examples-2" class="section level3">
<h3>Examples</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>clean_df <span class="ot">&lt;-</span> <span class="fu">myop</span>(wide_df)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">reveal</span>(clean_df)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          var mean  sd n min max</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  iop_preop 27.5 5.5 8  21  34</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 iop_postop 12.5 1.2 8  11  14</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   va_preop 42.5 1.2 8  41  44</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  va_postop 46.5 1.2 8  45  48</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">reveal</span>(clean_df, <span class="at">by =</span> <span class="st">&quot;eye&quot;</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     eye        var mean  sd n min max</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  left  iop_preop 32.5 1.3 4  31  34</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  left iop_postop 12.5 1.3 4  11  14</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  left   va_preop 42.5 1.3 4  41  44</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  left  va_postop 46.5 1.3 4  45  48</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 right  iop_preop 22.5 1.3 4  21  24</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 right iop_postop 12.5 1.3 4  11  14</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 right   va_preop 42.5 1.3 4  41  44</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8 right  va_postop 46.5 1.3 4  45  48</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="fu">reveal</span>(clean_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;eye&quot;</span>, <span class="st">&quot;surgery&quot;</span>))</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      eye surgery        var mean  sd n min max</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   left     SLT  iop_preop 34.0  NA 1  34  34</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   left     SLT iop_postop 14.0  NA 1  14  14</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   left     SLT   va_preop 44.0  NA 1  44  44</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   left     SLT  va_postop 48.0  NA 1  48  48</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  right     SLT  iop_preop 23.5 0.7 2  23  24</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  right     SLT iop_postop 13.5 0.7 2  13  14</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7  right     SLT   va_preop 43.5 0.7 2  43  44</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8  right     SLT  va_postop 47.5 0.7 2  47  48</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9   left      TE  iop_preop 32.0 1.0 3  31  33</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  left      TE iop_postop 12.0 1.0 3  11  13</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11  left      TE   va_preop 42.0 1.0 3  41  43</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12  left      TE  va_postop 46.0 1.0 3  45  47</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13 right      TE  iop_preop 21.5 0.7 2  21  22</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14 right      TE iop_postop 11.5 0.7 2  11  12</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15 right      TE   va_preop 41.5 0.7 2  41  42</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16 right      TE  va_postop 45.5 0.7 2  45  46</span></span></code></pre></div>
</div>
</div>
<div id="getage" class="section level2">
<h2>Calculate age</h2>
<p>This is a simple function and should not require much explanation. However, it may be noteworthy to mention the subtle distinction of periods and durations, which are an idiosyncrasy of time measurements and well explained <a href="https://lubridate.tidyverse.org/articles/lubridate.html#time-intervals">in this thread.</a></p>
<div id="examples-3" class="section level3">
<h3>Examples</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dob <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1984-10-16&quot;</span>, <span class="st">&quot;2000-01-01&quot;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="do">## If no second date given, the age today</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">getage</span>(dob)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 36.9 21.7</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="do">## If the second argument is specified, the age until then</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">getage</span>(dob, <span class="st">&quot;2000-01-01&quot;</span>)                                                    </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 15.2  0.0</span></span></code></pre></div>
</div>
</div>
<div id="important-notes" class="section level2">
<h2>Important notes</h2>
<p><strong>I do not assume responsability for your data or analysis</strong>. Please always keep a critical mind when working with data - if you do get results that seem implausible, there may be a chance that the data is in an unfortunate shape for which <code>eye</code> may not be suitable.</p>
<div id="va-conversion-chart" class="section level3">
<h3>VA conversion chart</h3>
<p>This chart is included in the package as <code>va_chart</code></p>
<div style="font-size:8 pt;">
<table>
<thead>
<tr class="header">
<th>Snellen feet</th>
<th>Snellen meter</th>
<th>Snellen decimal</th>
<th>logMAR</th>
<th>ETDRS</th>
<th>Categories</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>20/20000</td>
<td>6/6000</td>
<td>0.001</td>
<td>3</td>
<td>0</td>
<td>NLP</td>
</tr>
<tr class="even">
<td>20/10000</td>
<td>6/3000</td>
<td>0.002</td>
<td>2.7</td>
<td>0</td>
<td>LP</td>
</tr>
<tr class="odd">
<td>20/4000</td>
<td>6/1200</td>
<td>0.005</td>
<td>2.3</td>
<td>0</td>
<td>HM</td>
</tr>
<tr class="even">
<td>20/2000</td>
<td>6/600</td>
<td>0.01</td>
<td>1.9</td>
<td>2</td>
<td>CF</td>
</tr>
<tr class="odd">
<td>20/800</td>
<td>6/240</td>
<td>0.025</td>
<td>1.6</td>
<td>5</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/630</td>
<td>6/190</td>
<td>0.032</td>
<td>1.5</td>
<td>10</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/500</td>
<td>6/150</td>
<td>0.04</td>
<td>1.4</td>
<td>15</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/400</td>
<td>6/120</td>
<td>0.05</td>
<td>1.3</td>
<td>20</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/320</td>
<td>6/96</td>
<td>0.062</td>
<td>1.2</td>
<td>25</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/300</td>
<td>6/90</td>
<td>0.067</td>
<td>1.18</td>
<td>26</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/250</td>
<td>6/75</td>
<td>0.08</td>
<td>1.1</td>
<td>30</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/200</td>
<td>6/60</td>
<td>0.1</td>
<td>1.0</td>
<td>35</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/160</td>
<td>6/48</td>
<td>0.125</td>
<td>0.9</td>
<td>40</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/125</td>
<td>6/38</td>
<td>0.16</td>
<td>0.8</td>
<td>45</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/120</td>
<td>6/36</td>
<td>0.167</td>
<td>0.78</td>
<td>46</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/100</td>
<td>6/30</td>
<td>0.2</td>
<td>0.7</td>
<td>50</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/80</td>
<td>6/24</td>
<td>0.25</td>
<td>0.6</td>
<td>55</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/70</td>
<td>6/21</td>
<td>0.29</td>
<td>0.54</td>
<td>58</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/63</td>
<td>6/19</td>
<td>0.32</td>
<td>0.5</td>
<td>60</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/60</td>
<td>6/18</td>
<td>0.33</td>
<td>0.48</td>
<td>61</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/50</td>
<td>6/15</td>
<td>0.4</td>
<td>0.4</td>
<td>65</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/40</td>
<td>6/12</td>
<td>0.5</td>
<td>0.3</td>
<td>70</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/32</td>
<td>6/9.6</td>
<td>0.625</td>
<td>0.2</td>
<td>75</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/30</td>
<td>6/9</td>
<td>0.66</td>
<td>0.18</td>
<td>76</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/25</td>
<td>6/7.5</td>
<td>0.8</td>
<td>0.1</td>
<td>80</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/20</td>
<td>6/6</td>
<td>1.0</td>
<td>0.0</td>
<td>85</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/16</td>
<td>6/5</td>
<td>1.25</td>
<td>-0.1</td>
<td>90</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/15</td>
<td>6/4.5</td>
<td>1.33</td>
<td>-0.12</td>
<td>91</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>20/13</td>
<td>6/4</td>
<td>1.5</td>
<td>-0.2</td>
<td>95</td>
<td>NA</td>
</tr>
<tr class="even">
<td>20/10</td>
<td>6/3</td>
<td>2.0</td>
<td>-0.3</td>
<td>100</td>
<td>NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="acknowledgements" class="section level2">
<h2>Acknowledgements</h2>
<ul>
<li>Thanks to <strong>Alasdair Warwick</strong>, <strong>Aaron Lee</strong>, <strong>Tim Yap</strong>, <strong>Siegfried Wagner</strong> and <strong>Abraham Olvera</strong> for great suggestions, testing and code review.<br />
</li>
<li><strong>Pearse Keane</strong>, <strong>Dun Jack Fu</strong>, <strong>Katrin Fasler</strong> and <strong>Christoph Kern</strong> for their contribution of open source data</li>
<li>Thanks to <a href="https://github.com/moodymudskipper">Antoine Fabri</a> for his contribution to <code>getage()</code></li>
<li>Thanks to Hadley Wickham and all developers of the <code>tidyverse</code> packages and the packages <code>roxygen2</code>, <code>usethis</code>, <code>testthis</code> and <code>devtools</code>, all on which <code>eye</code> heavily relies.</li>
</ul>
</div>
<div id="resources" class="section level2">
<h2>Resources</h2>
<ul>
<li><a href="https://michaelbach.de/sci/acuity.html">Michael Bach’s homepage</a></li>
<li><a href="https://michaelbach.de/sci/pubs/Bach2007IOVS_eLetter_FrACT.pdf">Michael Bach on NLP and LP</a></li>
</ul>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Beck, Roy W, Pamela S Moke, Andrew H Turpin, Frederick L Ferris, John Paul SanGiovanni, Chris A Johnson, Eileen E Birch, et al. 2003. “A Computerized Method of Visual Acuity Testing.” American Journal of Ophthalmology 135 (2). Elsevier BV: 194–205. <a href="https://doi.org/10.1016/s0002-9394(02)01825-1" class="uri">https://doi.org/10.1016/s0002-9394(02)01825-1</a>.</p>
<p>Gregori, Ninel Z, William Feuer, and Philip J Rosenfeld. 2010. “Novel Method for Analyzing Snellen Visual Acuity Measurements.” Retina 30 (7). Ovid Technologies (Wolters Kluwer Health): 1046–50. <a href="https://doi.org/10.1097/iae.0b013e3181d87e04" class="uri">https://doi.org/10.1097/iae.0b013e3181d87e04</a>.</p>
<p>Holladay, Jack T. 2004. “Visual Acuity Measurements.” Journal of Cataract and Refractive Surgery 30 (2): 287–90. <a href="https://doi.org/10.1016/j.jcrs.2004.01.014" class="uri">https://doi.org/10.1016/j.jcrs.2004.01.014</a>.</p>
<p>Schulze-Bonsel, Kilian, Nicolas Feltgen, Hermann Burau, Lutz Hansen, and Michael Bach. 2006. “Visual Acuities ‘Hand Motion’ and ‘Counting Fingers’ Can Be Quantified with the Freiburg Visual Acuity Test.” Investigative Ophthalmology &amp; Visual Science 47 (3): 1236–40. <a href="https://doi.org/10.1167/iovs.05-0981" class="uri">https://doi.org/10.1167/iovs.05-0981</a>.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
